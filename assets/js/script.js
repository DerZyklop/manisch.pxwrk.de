// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}u(t,e);t.prototype.defaults={manisch:"übersetzung fehlt",german:"übersetzung fehlt"};return t}(Backbone.Model);i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}u(t,e);t.prototype.model=n;t.prototype.byCategory=function(e){var n,r=this;n=new t;_.each(this.models,function(t){var r;r=t;return _.each(t.get("category"),function(t){if(t===e)return n.add(r)})});return n};t.prototype.search=function(e){var n,r,i=this;if(!e)return this;n=function(t,n,r){var i,s;i=t.toJSON();s=RegExp(e.toLowerCase());return i.german.toLowerCase().match(s)||i.manisch.toLowerCase().match(s)};r=new t(this.filter(n));return r};return t}(Backbone.Collection);r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}u(t,e);t.prototype.tagName="li";t.prototype.initialize=function(){var e=this;_.bindAll(this);return jQuery.ajax({url:"site/templates/item.html",async:!1,dataType:"html",success:function(t){return e.template=t},error:function(){}})};t.prototype.render=function(){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};jQuery(this.el).html(_.template(this.template,this.model.toJSON()));return this};t.prototype.unrender=function(){return $(this.el).remove()};return t}(Backbone.View);s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}u(t,e);t.prototype.functionLog=function(e){return console.log(e)};t.prototype.valueHasChanged=function(){var e;e=[];return function(t,n){var r;if(t===e[n])r=!1;else{e[n]=t;r=!0}return r}}();return t}(Backbone.View);t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}u(t,e);t.prototype.el="#list";t.prototype.translations=new i;t.prototype.visibleTranslations=new i;t.prototype.getItemsBySearch=function(e){var t,n=this;e==null&&(e=!1);this.functionLog("getItemsBySearch("+e+")");this.removeAllItems();t=this.visibleTranslations.search(e);return _.each(t.models,function(e){return n.appendItem(e)})};t.prototype.getItemsByCategory=function(e){this.functionLog("getItemsByCategory()");jQuery(".sort.active").removeClass("active");jQuery("#"+e).addClass("active");this.removeAllItems();return e==="all"?this.appendItems(this.translations):this.appendItems(this.translations.byCategory(e))};t.prototype.appendItem=function(e){var t;this.functionLog("appendItem()");t=new r({model:e});return $(this.el).append(t.render().el)};t.prototype.appendItems=function(e){var t=this;this.visibleTranslations=e;return _.each(e.models,function(e){e.set("currentlyVisible",!0);return t.appendItem(e)})};t.prototype.removeAllItems=function(){_.each(this.translations.models,function(e){return e.set("currentlyVisible",!1)});return $(this.el).html("")};t.prototype.setFocusToFirstInput=function(){return jQuery("input:visible:first:text").focus()};t.prototype.searchTimeout=!1;t.prototype.stopSearch=function(){console.log("stopSearch");return clearTimeout(this.searchTimeout)};t.prototype.render=function(){var e=this;this.functionLog("render()");this.getItemsByCategory("all");jQuery(".sort").on("click",function(t){var n;e.stopSearch();jQuery("#search").val("");e.setFocusToFirstInput();n=jQuery(t.target).attr("id");return e.getItemsByCategory(n)});this.setFocusToFirstInput();return jQuery("#search").on("keyup",function(t){var n,r;r=jQuery(t.target).val();n=jQuery(t.target).attr("id");if(e.valueHasChanged(r,n)){if(r===""){clearTimeout(e.searchTimeout);return e.getItemsBySearch()}clearTimeout(e.searchTimeout);return e.searchTimeout=setTimeout(function(){return e.getItemsBySearch(r)},10)}})};t.prototype.events={"click .sort":"getItemsByCategory"};t.prototype.initialize=function(){var e=this;this.functionLog("initialize()");_.bindAll(this);this.translations.fetch({url:"content/manisch.json",success:function(){return e.appendItems(e.translations)}});return this.render()};return t}(s);e=new t}).call(this);